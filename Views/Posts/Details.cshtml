@model LevelEditorWebApp.Models.Post

@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div>
    <h4>Post</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Title)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Title)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Body)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Body)
        </dd>
        <dt class = "col-sm-2">
            Last Updated At
            <!--Html.DisplayNameFor(model => model.CreatedAt)-->
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.CreatedAt)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Author)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Author)
        </dd>
        <dd>
        <dt class = "col-sm-2">
           <a asp-action="Download" asp-route-id="@Model?.PostId">Download</a>
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.ZipFileName)
        </dd>
    </dl>
</div>

<div class="mt-3 mb-3">
    <!-- add upvote/downVote buttons -->
    <form method="post" class="form-inline" asp-action="Vote">
        <input type="hidden" name="PostId" value="@Model.PostId" />
        <input type="hidden" name="Value" value="1" />
        <!--if user has voted +1 then set style to btn-warning, else to btn-secondary -->
        @{
            string upVoteStyle = "btn-secondary";
            if(ViewData["UserVoteValue"] != null && ViewData["UserVoteValue"].ToString() == "1")
                upVoteStyle = "btn-warning";
        }
        <button type="submit" class="btn @upVoteStyle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 16 16">
                <path d="m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
            </svg>
        </button>
    </form>
    <span id="voteCount" class="lead"><b>@ViewData["Votes"]</b></span>
    <form method="post" class="form-inline" asp-action="Vote">
        <input type="hidden" name="PostId" value="@Model.PostId" />
        <input type="hidden" name="Value" value="-1" />
        @{
            string downVoteStyle = "btn-secondary";
            if (ViewData["UserVoteValue"] != null && ViewData["UserVoteValue"].ToString() == "-1")
                downVoteStyle = "btn-primary";
        }
        <button type="submit" class="btn @downVoteStyle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
            </svg>
        </button>
    </form>
</div>

<div>
    @if (Context.User.Identity.Name is not null && Context.User.Identity.Name.Equals(Model.Author)) {
        @Html.ActionLink("Edit", "Edit", new { id = Model.PostId }); @: |
        @Html.ActionLink("Delete", "Delete", new { id = Model.PostId }); @: |
    }
    <a asp-action="Index"> Back to List</a>
</div>

<div class="mt-5 mb-5">
    <form class="form-floating" asp-action="AddComment">
        <input type="hidden" name="PostId" value="@Model.PostId" />
        <textarea class="form-control" required placeholder="Leave a comment here" 
                  id="floatingTextarea" style="width:50rem; height: 7rem" name="Content"></textarea>
        <label for="floatingTextarea">Leave a comment here</label>
        <div class="form-group mt-1">
                <!--<input type="submit" value="Comment" class="btn btn-primary" />-->
                <button class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
                    </svg>
                    Post
                </button>
        </div>
    </form>
</div>

<div class="mt-3">
<h4>Comments</h4>
    <hr />
    @if (ViewData["Comments"] == null || (ViewData["Comments"] as List<Comment>).Count == 0)
    {
        <p>There are no comments yet.</p>
    }
    else {
        @using LevelEditorWebApp.Classes;

        @foreach (var comment in ViewData["Comments"] as List<Comment>) {
                    <div class="card" style="width:50rem;">
                    <div class="card-body">
                        <h5 class="card-title">@comment.Username</h5>
                        <p class="card-text">@comment.Content</p>
                        <p class="card-text"><small class="text-muted">@comment.CreatedAt</small></p>
                        @if (Context.User.Identity.Name is not null && Context.User.Identity.Name.Equals(comment.Username)) {

                            <p class="card-footer">
                                <!-- Button trigger modal -->
                                @{string modalName = "deleteModal" + comment.Id; }
                                <!-- '#' because target id is used as data-bs-target -->
                                <button type="button" class="btn btn-danger" 
                                        data-bs-toggle="modal" data-bs-target="#@modalName">
                                    <i class="fa-solid fa-trash" style="color: #ffffff;"></i>
                                    Delete
                                </button>

                                <!-- Modal -->
                                    <div class="modal fade" id="@modalName" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="staticBackdropLabel">Delete comment</h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                Are you sure you want to delete your comment?
                                            </div>
                                                <form asp-action="DeleteUserComment" method="post">
                                                <input type="hidden" name="CommentId" value="@comment.Id" />
                                                <input type="hidden" name="PostId" value="@comment.PostId" />
                                                <div class="modal-footer">
                                                    <!--<button type="submit" class="btn btn-danger">Yes</button>-->
                                                    <!--<a asp-action="DeleteComment" asp-route-id="comment.Id" class="btn btn-danger">Delete</a>-->
                                                    <button type="submit" class="btn btn-danger">Yes</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </p>
                            
                        }
                    </div>
                </div>
        }
    }
</div>